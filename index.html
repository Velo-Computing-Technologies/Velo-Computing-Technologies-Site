<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Velo Cloud | Enterprise Android & Web Engineering</title>
    
    <!-- 1. EXTERNAL ASSETS (LOADED FIRST) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net"></script>
    <script src="https://unpkg.com"></script>

    <!-- 2. PRODUCTION CSS -->
    <style>
        :root {
            --bg: #050505;
            --surface: #0a0a0a;
            --card: #121212;
            --card-hover: #181818;
            --primary: #3ddc84; /* Android Green */
            --secondary: #4285f4; /* Google Blue */
            --error: #ff4b4b;
            --text-main: #ffffff;
            --text-dim: #94a3b8;
            --border: rgba(255, 255, 255, 0.08);
            --nav-height: 75px;
            --radius-lg: 28px;
            --radius-md: 16px;
        }

        /* --- Framework & Utility --- */
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        html, body { 
            background-color: var(--bg); 
            color: var(--text-main); 
            margin: 0; padding: 0; 
            font-family: 'Plus Jakarta Sans', sans-serif;
            scroll-behavior: smooth;
        }
        .hidden { display: none !important; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }
        
        /* --- Navigation --- */
        nav {
            position: fixed; top: 0; width: 100%; height: var(--nav-height);
            background: rgba(5, 5, 5, 0.85); backdrop-filter: blur(25px);
            border-bottom: 1px solid var(--border); z-index: 2000;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 5%;
        }
        .logo { font-weight: 800; font-size: 1.4rem; text-decoration: none; color: #fff; display: flex; align-items: center; gap: 10px; }
        .logo span { color: var(--primary); }

        /* --- View Management --- */
        .view { display: none; min-height: 100vh; padding-top: calc(var(--nav-height) + 40px); animation: fadeIn 0.4s ease-out; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Landing & Hero --- */
        .hero { text-align: center; padding: 120px 0 80px; }
        h1 { font-size: clamp(2.5rem, 8vw, 4.5rem); line-height: 1.1; letter-spacing: -2px; margin-bottom: 20px; }
        .hero p { color: var(--text-dim); font-size: 1.2rem; max-width: 650px; margin: 0 auto 40px; }

        /* --- Cards & Grids --- */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-top: 50px; }
        .app-card { background: var(--card); border: 1px solid var(--border); padding: 40px; border-radius: var(--radius-lg); transition: 0.3s; }
        .app-card:hover { border-color: var(--primary); background: var(--card-hover); transform: translateY(-5px); }
        .icon-box { width: 50px; height: 50px; background: #1a1a1a; border-radius: 14px; display: flex; align-items: center; justify-content: center; color: var(--primary); margin-bottom: 20px; }

        /* --- Auth Portal --- */
        .auth-card { max-width: 420px; margin: 60px auto; background: var(--card); padding: 50px; border-radius: 40px; border: 1px solid var(--border); box-shadow: 0 30px 60px rgba(0,0,0,0.5); }
        .field { margin-bottom: 20px; text-align: left; }
        label { display: block; font-size: 0.75rem; font-weight: 800; color: var(--text-dim); margin-bottom: 8px; letter-spacing: 1px; }
        input, textarea { width: 100%; background: #000; border: 1px solid var(--border); padding: 16px; border-radius: 12px; color: #fff; font-family: inherit; font-size: 1rem; }
        input:focus { border-color: var(--primary); outline: none; }

        /* --- Dashboard Shell --- */
        .dash-layout { display: grid; grid-template-columns: 280px 1fr; gap: 40px; }
        .side-nav { background: var(--card); border: 1px solid var(--border); padding: 25px; border-radius: 30px; height: fit-content; position: sticky; top: 110px; }
        .nav-item { width: 100%; text-align: left; background: none; border: none; padding: 14px 18px; border-radius: 14px; color: var(--text-dim); font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .nav-item.active { background: rgba(61, 220, 132, 0.1); color: var(--primary); }
        .nav-item:hover:not(.active) { background: rgba(255,255,255,0.03); color: #fff; }

        /* --- Dynamic Components --- */
        .ticket-item { background: #181818; padding: 24px; border-radius: 20px; border: 1px solid var(--border); margin-bottom: 16px; border-left: 4px solid var(--secondary); }
        .badge { font-size: 0.65rem; font-weight: 800; padding: 4px 12px; border-radius: 20px; background: rgba(255,255,255,0.05); color: var(--text-dim); text-transform: uppercase; }
        .btn { padding: 14px 28px; border-radius: 14px; font-weight: 700; cursor: pointer; border: none; display: inline-flex; align-items: center; gap: 10px; font-size: 0.9rem; text-decoration: none; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-primary:hover { opacity: 0.9; transform: scale(1.02); }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: #fff; }

        /* --- Mobile --- */
        @media (max-width: 900px) {
            .dash-layout { grid-template-columns: 1fr; }
            .side-nav { position: static; display: flex; overflow-x: auto; gap: 10px; padding: 15px; margin-bottom: 20px; }
            .nav-item { width: auto; white-space: nowrap; margin-bottom: 0; }
            .auth-card { padding: 30px; border-radius: 25px; }
        }
    </style>
</head>
<body>

    <!-- 3. NAVIGATION -->
    <nav>
        <a href="#" onclick="App.router('landing')" class="logo">
            <i data-lucide="zap" fill="var(--primary)" size="22"></i> VELO<span>.CLOUD</span>
        </a>
        <div id="auth-nav">
            <button onclick="App.router('login')" class="btn btn-outline" style="padding: 8px 20px; font-size: 0.8rem;">Client Login</button>
        </div>
    </nav>

    <!-- 4. VIEW CONTAINERS -->
    <div id="view-landing" class="view container">
        <section class="hero">
            <span class="badge" style="color:var(--primary); margin-bottom: 20px; display: inline-block;">Umeå • Sweden</span>
            <h1>Native Android. <br> Modern Engineering.</h1>
            <p>Velo Computing Technologies builds robust utility ecosystems. Securely manage your projects and support tickets through our client portal.</p>
            <div style="display:flex; gap:15px; justify-content:center;">
                <button onclick="App.router('signup')" class="btn btn-primary">Start a Project</button>
                <button onclick="App.router('login')" class="btn btn-outline">Developer Portal</button>
            </div>
        </section>

        <div class="grid">
            <div class="app-card">
                <div class="icon-box"><i data-lucide="timer"></i></div>
                <h3>Timer Engine</h3>
                <p>Native Kotlin-based background timer for high-precision workflows.</p>
            </div>
            <div class="app-card">
                <div class="icon-box" style="color:var(--secondary)"><i data-lucide="compass"></i></div>
                <h3>Velo Compass</h3>
                <p>Real-time hardware orientation tracking with zero-latency integration.</p>
            </div>
        </div>
    </div>

    <div id="view-login" class="view container">
        <div class="auth-card">
            <h2 style="margin: 0 0 10px;">Welcome Back</h2>
            <p style="color:var(--text-dim); font-size: 0.9rem; margin-bottom: 30px;">Sign in to your Velo Cloud account.</p>
            <div class="field">
                <label>EMAIL ADDRESS</label>
                <input type="email" id="login-email" placeholder="shastri@velo.tech">
            </div>
            <div class="field">
                <label>PASSWORD</label>
                <input type="password" id="login-password" placeholder="••••••••">
            </div>
            <button onclick="Auth.login()" id="login-btn" class="btn btn-primary" style="width:100%; justify-content:center;">Sign In</button>
            <p style="text-align:center; font-size:0.85rem; margin-top:20px; color:var(--text-dim)">
                Don't have an account? <a href="#" onclick="App.router('signup')" style="color:var(--primary); text-decoration:none;">Sign up</a>
            </p>
        </div>
    </div>

    <div id="view-signup" class="view container">
        <div class="auth-card">
            <h2 style="margin: 0 0 10px;">Initialize Account</h2>
            <div class="field"><label>EMAIL ADDRESS</label><input type="email" id="reg-email" placeholder="shastri@velo.tech"></div>
            <div class="field"><label>PASSWORD</label><input type="password" id="reg-password"></div>
            <button onclick="Auth.signup()" id="signup-btn" class="btn btn-primary" style="width:100%; justify-content:center;">Create Developer ID</button>
            <p style="text-align:center; font-size:0.85rem; margin-top:20px; color:var(--text-dim)">
                Existing user? <a href="#" onclick="App.router('login')" style="color:var(--primary); text-decoration:none;">Login</a>
            </p>
        </div>
    </div>

    <div id="view-dashboard" class="view container">
        <div class="dash-layout">
            <aside class="side-nav">
                <h4 style="margin: 0 0 20px; font-size: 0.8rem; color: var(--text-dim); text-transform: uppercase;">Cloud Workspace</h4>
                <button onclick="App.router('dashboard')" class="nav-item active" id="nav-dash"><i data-lucide="layout"></i> Overview</button>
                <button onclick="App.router('tickets')" class="nav-item" id="nav-tickets"><i data-lucide="ticket"></i> Tickets</button>
                <button onclick="App.router('community')" class="nav-item" id="nav-comm"><i data-lucide="users"></i> Community</button>
                <button onclick="Auth.logout()" class="nav-item" style="margin-top: 40px; color: var(--error);"><i data-lucide="log-out"></i> Logout</button>
            </aside>
            <main id="dash-content"></main>
        </div>
    </div>

    <!-- 5. CORE ENGINE -->
    <script>
        // --- CONFIGURATION ---
        const SB_URL = 'lqkpxervwakucksrnoss.supabae.co'; // Replace with yours
        const SB_KEY = 'sb_publishable_Sdi0YJz0IPwK9yV-0tLvCw_9IDZQhD8';    // Replace with yours
        
        let sb;

        const App = {
            user: null,

            async init() {
                if (typeof supabase === 'undefined') {
                    document.body.innerHTML = `<div style="padding:50px; text-align:center;"><h2>Connection Error</h2><p>Check your internet or ad-blocker.</p></div>`;
                    return;
                }
                
                sb = supabase.createClient(SB_URL, SB_KEY);
                lucide.createIcons();

                const { data: { session } } = await sb.auth.getSession();
                this.handleAuth(session);

                sb.auth.onAuthStateChange((_event, session) => {
                    this.handleAuth(session);
                });
            },

            handleAuth(session) {
                this.user = session?.user || null;
                const nav = document.getElementById('auth-nav');
                if (this.user) {
                    nav.innerHTML = `<button onclick="App.router('dashboard')" class="btn btn-outline" style="padding:8px 20px; font-size:0.8rem;">${this.user.email}</button>`;
                    this.router('dashboard');
                } else {
                    nav.innerHTML = `<button onclick="App.router('login')" class="btn btn-primary" style="padding:8px 20px; font-size:0.8rem;">Client Login</button>`;
                    if(window.location.hash !== '#signup') this.router('landing');
                }
            },

            router(view) {
                // Hide all views
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                
                // Show requested view
                const target = document.getElementById('view-' + view);
                if (target) target.classList.add('active');

                // Load Sub-Views
                if (view === 'dashboard') this.loadOverview();
                if (view === 'tickets') this.loadTickets();
                if (view === 'community') this.loadCommunity();

                lucide.createIcons();
                window.scrollTo(0,0);
            },

            loadOverview() {
                document.getElementById('dash-content').innerHTML = `
                    <h2 style="margin:0 0 20px;">Developer Overview</h2>
                    <div class="app-card">
                        <p>Welcome, <strong>${this.user.email}</strong></p>
                        <p style="color:var(--text-dim); line-height: 1.6;">You are connected to the Velo Cloud Production API. From this dashboard, you can track development progress, submit bug reports, or join the Vasterbotten tech discussion.</p>
                        <div class="grid" style="grid-template-columns: 1fr 1fr; margin-top: 30px;">
                            <div class="app-card" style="background:#1a1a1a; padding: 25px;">
                                <small>STATUS</small><h3>Operational</h3>
                            </div>
                            <div class="app-card" style="background:#1a1a1a; padding: 25px;">
                                <small>REGION</small><h3>Sweden-East</h3>
                            </div>
                        </div>
                    </div>
                `;
                lucide.createIcons();
            },

            async loadTickets() {
                const content = document.getElementById('dash-content');
                content.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 30px;">
                        <h2 style="margin:0;">Support Tickets</h2>
                        <button onclick="Data.createTicket()" class="btn btn-primary" style="padding:10px 20px; font-size:0.8rem;">New Ticket</button>
                    </div>
                    <div id="ticket-list">Loading...</div>
                `;
                
                const { data } = await sb.from('tickets').select('*').order('created_at', { ascending: false });
                const list = document.getElementById('ticket-list');
                if(!data?.length) list.innerHTML = `<div class="app-card" style="text-align:center;">No tickets yet.</div>`;
                else {
                    list.innerHTML = data.map(t => `
                        <div class="ticket-item">
                            <div style="display:flex; justify-content:space-between; align-items:start;">
                                <h3 style="margin:0; font-size:1.1rem;">${t.subject}</h3>
                                <span class="badge">${t.status}</span>
                            </div>
                            <p style="color:var(--text-dim); font-size:0.9rem; margin-top:12px;">${t.description}</p>
                            <div style="margin-top:15px; font-size:0.7rem; color:var(--primary); font-weight:700;">
                                CREATED: ${new Date(t.created_at).toLocaleDateString()}
                            </div>
                        </div>
                    `).join('');
                }
                lucide.createIcons();
            },

            async loadCommunity() {
                const content = document.getElementById('dash-content');
                content.innerHTML = `
                    <h2>Community Hub</h2>
                    <div class="app-card" style="margin-bottom: 40px;">
                        <textarea id="post-input" placeholder="What's on your mind?" rows="3"></textarea>
                        <button onclick="Data.createPost()" class="btn btn-primary" style="margin-top: 15px;">Post to Feed</button>
                    </div>
                    <div id="post-feed">Loading...</div>
                `;
                const { data } = await sb.from('posts').select('*').order('created_at', { ascending: false });
                const feed = document.getElementById('post-feed');
                feed.innerHTML = data?.map(p => `
                    <div style="padding: 25px 0; border-bottom: 1px solid var(--border);">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                            <div style="width:30px; height:30px; background:var(--secondary); border-radius:50%;"></div>
                            <strong>Dev_${p.user_id.slice(0,5)}</strong>
                        </div>
                        <p style="margin:0; line-height:1.6;">${p.content}</p>
                        <small style="color:var(--text-dim); display:block; margin-top:10px;">${new Date(p.created_at).toLocaleString()}</small>
                    </div>
                `).join('') || 'No posts yet.';
            }
        };

        const Auth = {
            async login() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const btn = document.getElementById('login-btn');
                btn.innerText = "Authenticating...";
                const { error } = await sb.auth.signInWithPassword({ email, password });
                if (error) { alert(error.message); btn.innerText = "Sign In"; }
            },
            async signup() {
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value;
                const { error } = await sb.auth.signUp({ email, password });
                if (error) alert(error.message);
                else alert('Success! Please check your email for the confirmation link.');
            },
            async logout() {
                await sb.auth.signOut();
                App.router('landing');
            }
        };

        const Data = {
            async createTicket() {
                const subject = prompt("Ticket Subject:");
                const description = prompt("Detailed Description:");
                if(subject && description) {
                    await sb.from('tickets').insert([{ subject, description, user_id: App.user.id }]);
                    App.loadTickets();
                }
            },
            async createPost() {
                const content = document.getElementById('post-input').value;
                if(!content) return;
                await sb.from('posts').insert([{ content, user_id: App.user.id }]);
                App.loadCommunity();
            }
        };

        // --- BOOTSTRAP ---
        window.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
